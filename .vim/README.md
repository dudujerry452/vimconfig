# Vim 配置按键表

> 完整的快捷键参考 - 涵盖所有配置的映射

---

## 📑 目录

- [基础编辑](#基础编辑)
- [窗口管理](#窗口管理)
- [终端](#终端)
- [文件浏览](#文件浏览)
- [代码补全与跳转](#代码补全与跳转)
- [搜索与高亮](#搜索与高亮)
- [语言特定 - Haskell](#语言特定---haskell)
- [语言特定 - Rust](#语言特定---rust)
- [自动闭合](#自动闭合)
- [系统级](#系统级)

---

## 基础编辑

### 保存与退出

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Ctrl+S` | N/I/V | 保存文件并返回普通模式 |
| `Ctrl+A` | N/I/V | 强制退出所有窗口（不保存） |
| `\q` | N | 强制退出所有窗口（`:qall!`） |

### 复制粘贴

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `\ya` | N | 复制整个文件到系统剪贴板 |

### 注释

| 快捷键 | 模式 | 功能 | 来源 |
|--------|------|------|------|
| `gc` | N/V | 切换行注释 | vim-commentary |
| `gcc` | N | 注释当前行 | vim-commentary |

### 包围文本

| 快捷键 | 模式 | 功能 | 来源 |
|--------|------|------|------|
| `ysw"` | N | 包围单词为 `"word"` | vim-surround |
| `yss"` | N | 包围整行为 `"line"` | vim-surround |
| `cs"'` | N | 将 `"` 改为 `'` | vim-surround |
| `ds"` | N | 删除包围的 `"` | vim-surround |

---

## 窗口管理

### 窗口切换

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Ctrl+H` | N | 跳转到左边窗口 |
| `Ctrl+J` | N | 跳转到下面窗口 |
| `Ctrl+K` | N | 跳转到上面窗口 |
| `Ctrl+L` | N | 跳转到右边窗口 |
| `Ctrl+H` | T | 从终端跳转到左边窗口（自动进入插入模式） |
| `Ctrl+J` | T | 从终端跳转到下面窗口（自动进入插入模式） |
| `Ctrl+K` | T | 从终端跳转到上面窗口（自动进入插入模式） |
| `Ctrl+L` | T | 从终端跳转到右边窗口（自动进入插入模式） |

### 标签页切换

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Shift+Tab` | N | 切换到下一个标签页 |
| `Alt+1` | N | 跳转到第 1 个标签页 |
| `Alt+2` | N | 跳转到第 2 个标签页 |
| `Alt+3` | N | 跳转到第 3 个标签页 |
| `Alt+4` ~ `Alt+9` | N | 跳转到第 4~9 个标签页 |
| `\1` | N | 跳转到第 1 个标签页（备用） |
| `\2` | N | 跳转到第 2 个标签页（备用） |
| `\3` ~ `\9` | N | 跳转到第 3~9 个标签页（备用） |

**注意**：
- 优先使用 `Alt+数字`（Option+数字 on Mac）
- 如果 `Alt+数字` 不工作，使用 `\数字`（Leader+数字）
- `Ctrl+数字` 在大多数终端中不被支持

**标签页常用命令**：
- `:tabnew` - 新建标签页
- `:tabclose` - 关闭当前标签页
- `gt` - 下一个标签页
- `gT` - 上一个标签页

---

## 终端

### vim-terminal 插件

#### 用户终端（自由 shell）

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Ctrl+Z` | N | 切换用户终端（5 行高） |
| `Ctrl+Z` | T | 切换用户终端 |
| `Esc` | T | 退出终端模式到普通模式 |

#### 命令终端（项目命令）

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `\g` | N | 切换命令终端（10 行高） |
| `\g` | T | 从终端内切换命令终端 |

#### 动态快捷键（基于 .vsettings.json）

快捷键根据文件类型和项目配置自动创建。
在源文件和命令终端内都可用（无需退出终端模式）。

**Haskell 默认映射** - 见 [语言特定 - Haskell](#语言特定---haskell)

**Rust 默认映射** - 见 [语言特定 - Rust](#语言特定---rust)

#### Vim 命令

| 命令 | 功能 |
|------|------|
| `:RunnerReload` | 重新加载 .vsettings.json 配置 |
| `:RunnerGenerateConfig [filetype]` | 生成配置模板 |
| `:RunnerShowMainFile` | 显示当前主文件信息 |
| `:RunnerExecute <cmd>` | 在命令终端执行命令 |
| `:RunnerToggleCommand` | 切换命令终端 |
| `:RunnerToggleUser` | 切换用户终端 |

---

## 文件浏览

### NERDTree

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Ctrl+T` | N | 切换 NERDTree（15 列宽） |

**NERDTree 内部快捷键**：

| 快捷键 | 功能 |
|--------|------|
| `Enter` | 打开文件/文件夹 |
| `o` | 打开文件/切换文件夹 |
| `s` | 垂直分屏打开文件 |
| `i` | 水平分屏打开文件 |
| `t` | 在新标签页打开 |
| `m` | 显示文件菜单（新建、删除、移动等） |
| `R` | 刷新当前目录 |
| `?` | 显示帮助 |

---

## 代码补全与跳转

### CoC (Conquer of Completion)

#### 补全

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `Tab` | I | 选择下一个补全项（或触发补全） |
| `Shift+Tab` | I | 选择上一个补全项 |
| `Enter` | I | 确认补全 |

#### 代码导航

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `gd` | N | 跳转到定义 |
| `gy` | N | 跳转到类型定义 |
| `gi` | N | 跳转到实现 |
| `gr` | N | 查找所有引用 |

---

## 搜索与高亮

| 快捷键 | 模式 | 功能 |
|--------|------|------|
| `/pattern` | N | 向下搜索 |
| `?pattern` | N | 向上搜索 |
| `n` | N | 下一个搜索结果 |
| `N` | N | 上一个搜索结果 |
| `Enter` | N | 清除搜索高亮 |
| `*` | N | 搜索光标下的单词 |
| `#` | N | 反向搜索光标下的单词 |

---

## 语言特定 - Haskell

### 默认映射（.hs 文件）

| 快捷键 | 模式 | 功能 | 命令类型 |
|--------|------|------|---------|
| `\l` | N/T | 在 ghci 中加载当前文件 | 普通（重启终端） |
| `\r` | N/T | 在 ghci 中重新加载 | 会话（`:reload`） |
| `\t` | N/T | 类型检查 main | 会话（`:type main`） |
| `\q` | N/T | 退出 ghci | 会话（`:quit`） |

**说明**：
- `\l`：每次执行都会关闭旧终端，创建新的 ghci 进程
- `\r`、`\t`、`\q`：在已有的 ghci 会话中执行（保持状态）

### 自定义配置

在项目根目录创建 `.vsettings.json`：

```json
{
  "l": "ghci {$}",
  "r": "@@:reload",
  "t": "@@:type main",
  "i": "@@:info main",
  "q": "@@:quit"
}
```

**变量**：
- `{$}` - 当前文件路径（自动转义）

**前缀**：
- 无前缀 - 普通命令（关闭旧终端）
- `@@` - 会话命令（发送到已有进程）

---

## 语言特定 - Rust

### 默认映射（.rs 文件）

| 快捷键 | 模式 | 功能 | 说明 |
|--------|------|------|------|
| `\b` | N/T | `cargo build` | 编译项目 |
| `\r` | N/T | `cargo run` | 运行项目 |
| `\c` | N/T | `cargo check` | 快速检查（推荐） |
| `\t` | N/T | `cargo test` | 运行测试 |

**说明**：
- 所有命令都会自动 cd 到项目根目录（通过 `Cargo.toml` 定位）
- 每次执行都会关闭旧终端，创建新的干净环境

### 自定义配置

```json
{
  "b": "cargo build --release",
  "r": "cargo run --release",
  "c": "cargo check",
  "t": "cargo test -- --nocapture",
  "d": "cargo doc --open"
}
```

---

## 自动闭合

### 基本闭合（~/.vim/autoclose.vim）

| 输入 | 结果 | 光标位置 |
|------|------|---------|
| `(` | `()` | 中间 |
| `[` | `[]` | 中间 |
| `{` | `{}` | 中间 |
| `"` | `""` | 中间 |
| `'` | `''` | 中间 |
| `` ` `` | ``` `` ``` | 中间 |

### 带分号/逗号闭合

| 输入 | 结果 | 光标位置 |
|------|------|---------|
| `(;` | `();` | 分号前 |
| `[;` | `[];` | 分号前 |
| `{;` | `{};` | 分号前 |
| `(,` | `(),` | 逗号前 |
| `[,` | `[],` | 逗号前 |
| `{,` | `{},` | 逗号前 |

### 带 Tab 闭合（光标在后）

| 输入 | 结果 | 光标位置 |
|------|------|---------|
| `(<Tab>` | `()` | 括号后 |
| `[<Tab>` | `[]` | 括号后 |
| `{<Tab>` | `{}` | 括号后 |
| `(;<Tab>` | `();` | 分号后 |
| `{;<Tab>` | `{};` | 分号后 |

### 多行闭合（Enter）

| 输入 | 结果 |
|------|------|
| `(<Enter>` | `(`<br>`  `<光标><br>`)` |
| `{<Enter>` | `{`<br>`  `<光标><br>`}` |
| `[<Enter>` | `[`<br>`  `<光标><br>`]` |
| `(;<Enter>` | `(`<br>`  `<光标><br>`);` |
| `{;<Enter>` | `{`<br>`  `<光标><br>`};` |

**注意**：输入 `(` 后有 1 秒延迟，Vim 等待判断你是否要输入 `;`、`,`、`<Tab>` 或 `<Enter>`。

---

## 系统级

### Leader 键

默认 Leader 键为 `\`（反斜杠）。

可在 `.vimrc` 中修改：
```vim
let mapleader = ","  " 改为逗号
```

### 超时设置

```vim
set timeoutlen=1000  " 1000ms (默认值) 等待下一个按键（用于组合键）
```

这影响：
- Leader 键组合（如 `\l`）
- 自动闭合检测（如 `(` 后等待 `;` 或 `,`）

**注意**：输入 `(` 后有 1 秒延迟，Vim 等待判断你是否要输入 `;`、`,`、`<Tab>` 或 `<Enter>`。

---

## 配置文件位置

```
~/.vimrc                              # 主配置文件
~/.vim/
  ├── plugins.vim                     # 插件管理（vim-plug）
  ├── plugin-config.vim               # 插件配置（NERDTree, CoC）
  ├── autoclose.vim                   # 自动闭合配置
  ├── directorylayout.vim             # 目录布局
  ├── ftplugin/
  │   ├── haskell.vim                 # Haskell 语言配置（备份）
  │   └── rust.vim                    # Rust 语言配置（备份）
  └── plugged/
      └── vim-terminal/               # 终端插件
          ├── plugin/vim-terminal.vim
          ├── autoload/terminal/
          ├── ftplugin/
          │   ├── haskell.vim         # Haskell 默认命令
          │   └── rust.vim            # Rust 默认命令
          └── doc/vim-terminal.txt    # 插件帮助文档
```

---

## 插件列表

| 插件 | 功能 |
|------|------|
| gruvbox | 配色主题 |
| nerdtree | 文件浏览器 |
| vim-airline | 状态栏 |
| vim-polyglot | 多语言语法高亮 |
| vim-commentary | 快速注释 |
| vim-surround | 包围文本操作 |
| coc.nvim | 代码补全和 LSP |
| vim-terminal | 智能终端和命令执行（自制） |

---

## 快速参考

### 最常用快捷键

```
保存：      Ctrl+S
退出：      Ctrl+A
窗口切换：  Ctrl+H/J/K/L
标签页：    Shift+Tab (下一个), Ctrl+1~9 (跳转)
文件树：    Ctrl+T
用户终端：  Ctrl+Z
命令终端：  \g

Haskell:
  加载：    \l
  重载：    \r

Rust:
  检查：    \c
  运行：    \r
  编译：    \b
  测试：    \t
```

### 模式说明

- **N**: Normal mode（普通模式）
- **I**: Insert mode（插入模式）
- **V**: Visual mode（可视模式）
- **T**: Terminal mode（终端模式）

---

## 帮助文档

```vim
:help vim-terminal          " vim-terminal 插件帮助
:help surround              " vim-surround 帮助
:help commentary            " vim-commentary 帮助
:help NERDTree              " NERDTree 帮助
```

---

## 自定义项目配置

在项目根目录创建 `.vsettings.json`：

```json
{
  "_comment": "自定义项目命令",
  "b": "make build",
  "r": "make run",
  "t": "make test",
  "c": "make clean",
  "d": "docker-compose up"
}
```

然后在项目的任何文件中使用 `\b`、`\r` 等快捷键。

**变量替换**：
- `{$}` - 当前文件路径（自动转义，支持空格）

**会话命令**：
- 使用 `@@` 前缀发送到已有进程（如 `@@:reload`）
- 不使用 `@@` 则关闭旧终端，创建新环境

---

最后更新：2026-01-10
